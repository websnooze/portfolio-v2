import { useEffect, useState } from "react";
import { AnimatePresence, motion } from "framer-motion";

import styles from "../css/topbar.module.css";

const ThemeSwitcher = () => {
  const [isLightTheme, setIsLightTheme] = useState(true);

  const toggleTheme = () => {
    setIsLightTheme((prevTheme) => !prevTheme);
  };

  const setDarkMode = () => {
    document.querySelector("body")?.setAttribute("data-theme", "dark");
    document
      .querySelector('meta[name="theme-color"]')
      ?.setAttribute("content", "#1b1b1f");
    localStorage.setItem("selectedTheme", "dark");
  };
  const setLightMode = () => {
    document.querySelector("body")?.setAttribute("data-theme", "light");
    document
      .querySelector('meta[name="theme-color"]')
      ?.setAttribute("content", "#ffffff");
    localStorage.setItem("selectedTheme", "light");
  };

  useEffect(() => {
    if (isLightTheme) {
      setLightMode();
    } else {
      setDarkMode();
    }
  }, [isLightTheme]);

  return (
    <div className={styles.ThemeToggle} onClick={toggleTheme}>
      <AnimatePresence mode="wait">
        {isLightTheme ? (
          <motion.svg
            key="light"
            initial={{ rotate: 180 }}
            animate={{ rotate: 0 }}
            exit={{ rotate: 180 }}
            transition={{ duration: 0.1 }}
            height={16}
            fill="var(--text-dark)"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 40 40">
            <motion.path d="M16.91488,24.39051l-1.55911-2.346a.58865.58865,0,0,1,.81632-.81632L18.34161,22.677a.23576.23576,0,0,0,.36771-.19121l.68395-20.7244a.61082.61082,0,0,1,1.22081,0l.69131,20.73176a.24052.24052,0,0,0,.36771.19121l2.16952-1.4488a.58866.58866,0,0,1,.81633.81633l-1.56647,2.33866a.23284.23284,0,0,0,.14709.36036l2.76521.55158a.58489.58489,0,0,1,0,1.14726l-2.76521.56629a.23284.23284,0,0,0-.14709.36036l1.55911,2.346a.58866.58866,0,0,1-.81632.81633l-1.93418-1.29435a.23811.23811,0,0,0-.36772.20591l.15444,4.5229a9.41712,9.41712,0,0,0,4.72881-16.15738,1.20725,1.20725,0,0,1,.07355-1.79445,10.60941,10.60941,0,0,0,3.50064-11.9066c-.3383-.95606.75014-2.20629,1.57382-1.61795a20.00606,20.00606,0,0,1,7.92793,11.81835.47694.47694,0,0,1-.125.4339l-2.08862,2.08862a.46958.46958,0,0,0,.33094.80162H39.522a.457.457,0,0,1,.46332.44126c.00735.24269.01471.48538.01471.73543a20.56874,20.56874,0,0,1-.353,3.77275.51282.51282,0,0,1-.125.24269l-3.41975,3.41975a.46958.46958,0,0,0,.33095.80161H37.5069a.46351.46351,0,0,1,.41919.66189A20.0121,20.0121,0,0,1,2.08127,27.722a.45831.45831,0,0,1,.41919-.66189H3.56683a.468.468,0,0,0,.331-.80162L.48538,22.83876a.4305.4305,0,0,1-.125-.24269A19.94608,19.94608,0,0,1,0,18.82331c0-.24269.00735-.49273.01471-.73543A.45694.45694,0,0,1,.478,17.64663H2.39015a.468.468,0,0,0,.33094-.80162L.63247,14.749a.47137.47137,0,0,1-.125-.4339A20.04961,20.04961,0,0,1,8.44273,2.49678c.831-.58834,1.91212.65453,1.57382,1.61795a10.60941,10.60941,0,0,0,3.50064,11.9066,1.20724,1.20724,0,0,1,.07354,1.79444,9.41713,9.41713,0,0,0,4.72882,16.15739l.15444-4.52289a.23811.23811,0,0,0-.36772-.20592L16.17209,30.5387a.58865.58865,0,0,1-.81632-.81632l1.55911-2.346a.23284.23284,0,0,0-.14709-.36036l-2.76522-.55158a.58489.58489,0,0,1,0-1.14726l2.76522-.55158a.23285.23285,0,0,0,.14709-.36036Z" />
          </motion.svg>
        ) : (
          <motion.svg
            key="dark"
            initial={{ rotate: -180 }}
            animate={{ rotate: 0 }}
            exit={{ rotate: -180 }}
            transition={{ duration: 0.1 }}
            height={16}
            fill="var(--text-dark)"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 40 40">
            <motion.path d="M19.9813,24.98683a66.53173,66.53173,0,0,1-18.53717-2.7314,1.76992,1.76992,0,0,1-1.444-2.02708A20.02833,20.02833,0,0,1,31.355,3.51761a2.50824,2.50824,0,0,1,.96736,2.95559c-.07134.35028-.56228.65253-.91827.89193a1.3564,1.3564,0,0,1-.73562.06442c-3.714-.15006-3.23439.26481-3.26441,3.554a1.33037,1.33037,0,0,0,1.52759,1.532q2.13008-.02261,4.26053.00139c1.3407.017,1.74151.38485,1.72351,1.712-.04571,3.36854-.0514,3.39377,3.27974,3.28842,1.17378-.03712,1.63106.52755,1.72285,1.6405.20806,2.52282.191,2.57456-2.20362,3.313A65.59242,65.59242,0,0,1,19.9813,24.98683ZM14.99492,6.18059a6.2997,6.2997,0,1,0,6.33588,6.37065A6.30851,6.30851,0,0,0,14.99492,6.18059Z" />
            <motion.path d="M.76706,24.82476a70.0207,70.0207,0,0,0,28.97217,2.1424,2.65279,2.65279,0,0,1,.15591.5264c.14514,2.5572.14318,2.551,2.767,2.56478.81569.00428,1.85449-.22007,2.12984.82679a2.857,2.857,0,0,1-.50657,3.04458c-5.438,5.22123-11.82141,7.25093-19.19333,5.38143C7.77673,37.456,3.09014,32.72371.81651,25.56454a2.17465,2.17465,0,0,1-.086-.36534A2.21648,2.21648,0,0,1,.76706,24.82476Z" />
            <motion.path d="M12.56843,12.42242a2.37533,2.37533,0,0,1,2.47287-2.40815,2.46819,2.46819,0,0,1-.11313,4.93178A2.37889,2.37889,0,0,1,12.56843,12.42242Z" />
          </motion.svg>
        )}
      </AnimatePresence>
    </div>
  );
};

export default ThemeSwitcher;
